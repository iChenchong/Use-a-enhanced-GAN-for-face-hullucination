# Use-an-enhanced-GAN-for-face-hullucination
Super Resolution, GAN
算法基于Tensorflow框架开发，整个图像超分辨率模块的功能主要集中在main.py、model.py和ops.py三个文件中。

main.py文件是启动整个图像超分辨率模块的入口，这里首先定义了在整个图像超分辨率模块中都需要被使用到的全局变量。比较重要的全局变量分别有图像输入/输出目录，参数模型输出目录、是否需要预训练模型、模型的调用模式选择、图像在训练时被分块的大小、学习速率、迭代次数和每经过多少次迭代保存一次参数模块等。

main.py在执行时会首先判断是否用户是否给出了输出目录，在执行训练过程时，输出目录用于保存参数模型，而在测试过程中，输出目录用来保存重建出的图像。然后main.py文件会判断用户选择的是何种执行模式，用户选择测试模式时，模块就不会执行数据增量处理，模块会将输入文件夹的路径直接传给model.py文件，model.py会从用户给出的输入目录中读取所有的图片来对图像进行超分辨率重建，最后将重建出的图像保存在用户指定的文件夹中。

用户选择训练模式时，模块会将输入文件夹的路径直接传给model.py文件，main.py文件会在训练的每一轮都接受模型计算返回的各种损失函数值和当前超分辨率重建出图像的PSNR值，这些数值会在shell窗口上实时更新，用来方便用户观测这些重要数值的变化，最后模型会根据用户设定的参数模型保存批次来判断每训练完多少轮保存一次参数模型。

在model.py文件中定义了数据读取方法和模型方法，首先使数据读取方法，数据读取方法会接收main.py传送来的图片路径，然后根据路径读取文件夹中的图片并对这些进行数据增量等一系列预处理，这些预处理好的图像会被输入到模型方法中去。在模型方法中定义本文所提出的模型结构，其中的生成器方法会接受数据读取方法输出的图像并对这些图像进行特征提取和超分辨率重建，最后输出超分辨率重建后的图像。

鉴别器方法会接受生成器方法生成的重建图像，然后通过特征提取、全连接层和Sigmoid函数来输出判断概率。在经过这一系列的处理后，这一轮的训练过程就结束了，接下来是在优化方法中利用在训练过程中提取的特征映射，重建图像和判断概率来对模型进行优化。优化方法首先会收集模型超分辨率重建出的图像和与之对应的原始高分辨率图像，然后计算二者之间的均方误差并将计算结果保存为内容损失。

接着优化方法会使用鉴别器方法在训练过程中提取的特征映射，通过计算重建的高分辨率图像和原始的高分辨率图像在特征映射中的差值来得到特征域感知损失。然后优化方法会利用鉴别器输出的对重建的高分辨率图像和原始的高分辨率图像的判断概率来计算出对抗损失。

在得到所有的损失函数后，优化会将内容损失、特征域感知损失和对抗损失结合起来作为生成器的最终损失函数，将特征域感知损失和对抗损失结合起来作为鉴别器的最终损失函数。在model.py文件的最后定义了保存图像的方法，模型会在测试阶段调用该方法来将模型超分辨率重建出的图像保存在用户给出的输出路径中。model.py文件调用ops.py文件中封装好的方法来实现模型的循环训练和优化。最终将训练时得到的参数模型或者时测试时得到的超分辨率重建结构返回main.py文件。

ops.py文件中将Tensorflow框架提供的卷积层、激活函数、全连接层、图像随机翻转和上采样层等一系列接口进行了封装，来更加适应本设计的结构。在ops.py文件中的卷积层方法需要接受model.py方法传入的5种参数，分别为输入图像、卷积核的大小、卷积后的输出通道、卷积核移动的步幅和是否使用偏差。

激活函数方法接收从模型中传入的图像然后调用了Tensorflow框架提供的激活函数接口，最后将结果返回模型中。全连接层方法的执行过程类似激活函数方法，这里就不在赘述。图像随机翻转方法会被model.py文件中的数据读取方法调用来进行数据增量处理。上采样层方法的作用是将输入图像的分辨率放大两倍，以此在4倍超分辨率重建问题中需要调用两次该方法来获得最终的超分辨率结果。

因为开发环境选择的是Ubuntu，因此可以将一段长终端命令写在一个shell文件中来快速执行。
